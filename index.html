<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Finans Asistanƒ±m</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                    },
                    colors: {
                        luxury: {
                            black: '#000000',
                            card: '#09090b',
                            border: '#27272a',
                            gold: '#D4AF37', // Ger√ßek altƒ±n rengi
                            goldLight: '#F3E5AB',
                            goldDark: '#AA8C2C',
                        }
                    },
                    animation: {
                        'fade-in-up': 'fadeInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1)',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: #000000;
            color: #d4d4d8; /* Zinc-300 */
            -webkit-tap-highlight-color: transparent;
        }
        
        /* Gizli Scrollbar */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        /* Premium Glass Effect - Darker & Glossy */
        .glass-premium {
            background: rgba(20, 20, 20, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-top: 1px solid rgba(212, 175, 55, 0.15); /* Altƒ±n yansƒ±ma */
            box-shadow: 0 -10px 40px rgba(0,0,0,0.8);
        }

        /* Nav Item Animasyonlarƒ± */
        .nav-item { position: relative; color: #52525b; transition: all 0.4s ease; }
        .nav-item.active { color: #D4AF37; } /* Altƒ±n rengi */
        .nav-item.active i {
            text-shadow: 0 0 20px rgba(212, 175, 55, 0.4);
            transform: translateY(-4px) scale(1.1);
            weight: fill;
        }
        
        /* Altƒ±n Gradient Text */
        .text-gradient-gold {
            background: linear-gradient(to right, #D4AF37, #F3E5AB, #D4AF37);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-size: 200% auto;
            animation: shine 5s linear infinite;
        }

        @keyframes shine {
            to { background-position: 200% center; }
        }
        
        /* Switch Toggle Stili - Gold */
        .toggle-checkbox:checked { right: 0; border-color: #D4AF37; }
        .toggle-checkbox:checked + .toggle-label { background-color: #D4AF37; }
        
        /* Gecikmeli Animasyonlar */
        .stagger-1 { animation-delay: 50ms; }
        .stagger-2 { animation-delay: 100ms; }
        .stagger-3 { animation-delay: 150ms; }
        .stagger-4 { animation-delay: 200ms; }
        .stagger-5 { animation-delay: 250ms; }

        /* √ñzel Input Stili */
        select { -webkit-appearance: none; -moz-appearance: none; appearance: none; }
        input[type="date"]::-webkit-calendar-picker-indicator { filter: invert(0.8) sepia(1) saturate(5) hue-rotate(5deg); opacity: 0.8; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden selection:bg-luxury-gold/30">

    <!-- √úst Bar (Header) -->
    <header class="px-6 py-6 flex justify-between items-end z-30 sticky top-0 bg-gradient-to-b from-black via-black/90 to-transparent">
        <div>
            <p class="text-[9px] text-zinc-500 font-bold tracking-[0.2em] uppercase mb-1">Ki≈üisel Finans</p>
            <h1 id="page-title" class="text-3xl font-bold text-white tracking-tight">C√ºzdan</h1>
        </div>
        <div class="w-11 h-11 rounded-full bg-zinc-900 border border-zinc-800 flex items-center justify-center shadow-lg shadow-zinc-900/50 ring-1 ring-white/5">
            <i class="ph-fill ph-user text-zinc-400 text-xl"></i>
        </div>
    </header>

    <!-- Ana ƒ∞√ßerik Alanƒ± -->
    <main id="main-content" class="flex-1 overflow-y-auto hide-scroll pb-32 px-5 pt-2">
        <!-- ƒ∞√ßerik JavaScript ile buraya y√ºklenecek -->
    </main>

    <!-- Alt Navigasyon Men√ºs√º -->
    <nav class="fixed bottom-0 w-full z-40 pb-safe">
        <!-- Blur Gradient Background -->
        <div class="absolute inset-x-0 bottom-0 h-40 bg-gradient-to-t from-black via-black/95 to-transparent pointer-events-none"></div>
        
        <div class="glass-premium relative mx-4 mb-5 rounded-[2.5rem] flex items-center justify-between px-7 py-5">
            <button onclick="switchTab('dashboard')" class="nav-item active flex flex-col items-center gap-1" data-tab="dashboard">
                <i class="ph ph-house text-2xl"></i>
            </button>
            <button onclick="switchTab('wallet')" class="nav-item flex flex-col items-center gap-1" data-tab="wallet">
                <i class="ph ph-chart-pie-slice text-2xl"></i>
            </button>

            <!-- Orta Ekleme Butonu (Altƒ±n) -->
            <div class="relative -top-10 mx-2">
                <div class="absolute inset-0 bg-luxury-gold rounded-full blur-2xl opacity-20"></div>
                <button onclick="toggleModal('addTransactionModal')" class="relative w-16 h-16 bg-gradient-to-b from-[#D4AF37] to-[#AA8C2C] text-black rounded-full shadow-2xl shadow-luxury-gold/20 flex items-center justify-center transform transition-all active:scale-90 hover:rotate-90 duration-500 ring-4 ring-black">
                    <i class="ph-bold ph-plus text-3xl"></i>
                </button>
            </div>

            <button onclick="switchTab('debts')" class="nav-item flex flex-col items-center gap-1" data-tab="debts">
                <i class="ph ph-hand-coins text-2xl"></i>
            </button>
            <button onclick="switchTab('settings')" class="nav-item flex flex-col items-center gap-1" data-tab="settings">
                <i class="ph ph-gear text-2xl"></i>
            </button>
        </div>
    </nav>

    <!-- EKLEME MODALI -->
    <div id="addTransactionModal" class="fixed inset-0 z-50 hidden transition-opacity duration-300">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl transition-opacity" onclick="toggleModal('addTransactionModal')"></div>
        <div class="absolute bottom-0 w-full bg-[#09090b] rounded-t-[2.5rem] shadow-2xl shadow-black border-t border-zinc-800 transform transition-transform duration-300 translate-y-full flex flex-col max-h-[90vh]" id="modal-panel">
            <div class="w-full flex justify-center pt-5 pb-2" onclick="toggleModal('addTransactionModal')">
                <div class="w-12 h-1 bg-zinc-800 rounded-full"></div>
            </div>
            
            <div class="px-6 pb-10 pt-4 overflow-y-auto">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-2xl font-bold text-white">Yeni ƒ∞≈ülem</h2>
                    <button onclick="toggleModal('addTransactionModal')" class="w-9 h-9 rounded-full bg-zinc-900 border border-zinc-800 text-zinc-400 flex items-center justify-center hover:bg-zinc-800 transition-colors"><i class="ph-bold ph-x"></i></button>
                </div>
                
                <form onsubmit="handleAddTransaction(event)" class="space-y-6">
                    <!-- Switch (Renklendirilmi≈ü & Mat) -->
                    <div class="flex bg-zinc-900/50 p-1.5 rounded-2xl border border-zinc-800">
                        <button type="button" onclick="setTxType('income')" id="btn-income" class="flex-1 py-3.5 rounded-xl text-sm font-bold transition-all duration-300 bg-emerald-900/80 text-emerald-400 border border-emerald-500/20 shadow-lg">Gelir</button>
                        <button type="button" onclick="setTxType('expense')" id="btn-expense" class="flex-1 py-3.5 rounded-xl text-sm font-bold transition-all duration-300 text-zinc-500 hover:text-white">Gider</button>
                    </div>

                    <div class="bg-black/40 p-6 rounded-3xl border border-zinc-800 focus-within:border-luxury-gold/50 transition-colors">
                        <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wider mb-2">Tutar</label>
                        <div class="relative flex items-center">
                            <span class="text-3xl text-zinc-600 font-light mr-3">‚Ç∫</span>
                            <input type="number" id="tx-amount" required class="w-full bg-transparent text-5xl font-bold text-white focus:outline-none placeholder:text-zinc-800 tracking-tight" placeholder="0">
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div>
                            <input type="text" id="tx-desc" required class="w-full bg-[#121214] border border-zinc-800 rounded-2xl py-4 px-5 font-medium text-white placeholder:text-zinc-600 focus:outline-none focus:border-luxury-gold/50 focus:ring-1 focus:ring-luxury-gold/50 transition-all" placeholder="A√ßƒ±klama (√ñrn: Maa≈ü, Prim)">
                        </div>

                        <div class="relative">
                            <select id="tx-category" onchange="checkCategory(this.value)" class="w-full bg-[#121214] border border-zinc-800 rounded-2xl py-4 px-5 font-medium text-white focus:outline-none focus:border-luxury-gold/50 focus:ring-1 focus:ring-luxury-gold/50 transition-all appearance-none">
                                <option value="Market">üõí Market / Pazar</option>
                                <option value="Fatura">üìÑ Fatura</option>
                                <option value="Kira">üè† Kira</option>
                                <option value="Ula≈üƒ±m">üöå Ula≈üƒ±m</option>
                                <option value="Yemek">üçî Yemek</option>
                                <option value="Sigara">üö¨ Sigara</option>
                                <option value="Eƒüitim">üìö Eƒüitim</option>
                                <option value="Giyim">üëï Giyim</option>
                                <option value="Saƒülƒ±k">üíä Saƒülƒ±k</option>
                                <option value="Eƒülence">üéâ Eƒülence</option>
                                <option value="Maa≈ü">üí∞ Maa≈ü</option>
                                <option value="Bor√ß √ñdeme" id="opt-debt-payment" class="hidden text-rose-400">üí∏ Bor√ß √ñdeme</option>
                                <option value="Diƒüer">üîπ Diƒüer</option>
                            </select>
                            <i class="ph-bold ph-caret-down absolute right-5 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none"></i>
                        </div>
                    </div>

                    <!-- Bor√ß Se√ßimi -->
                    <div id="debt-selector-wrapper" class="hidden animate-fade-in-up bg-rose-950/20 p-4 rounded-2xl border border-rose-900/30">
                        <label class="block text-[10px] font-bold text-rose-400 mb-2 uppercase tracking-wide">Hangi Bor√ß?</label>
                        <div class="relative">
                            <select id="tx-debt-select" class="w-full bg-[#18181b] border border-rose-900/30 rounded-xl py-3 px-4 focus:outline-none text-sm text-rose-100 font-medium">
                                <option value="">Se√ßiniz...</option>
                            </select>
                            <i class="ph-bold ph-caret-down absolute right-4 top-1/2 -translate-y-1/2 text-rose-400 pointer-events-none"></i>
                        </div>
                    </div>

                    <button type="submit" class="w-full bg-gradient-to-r from-[#D4AF37] to-[#AA8C2C] text-black font-bold py-4 rounded-2xl shadow-lg shadow-luxury-gold/10 active:scale-[0.98] transition-all flex items-center justify-center gap-2 text-lg hover:brightness-110">
                        Kaydet
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Fƒ∞LTRELEME MODALI -->
    <div id="filterModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl" onclick="toggleModal('filterModal')"></div>
        <div class="absolute bottom-0 w-full bg-[#09090b] rounded-t-[2rem] p-6 shadow-2xl border-t border-zinc-800 transform transition-transform duration-300 translate-y-full" id="filter-modal-panel">
            <div class="w-10 h-1 bg-zinc-800 rounded-full mx-auto mb-6"></div>
            
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-xl font-bold text-white">Filtrele</h2>
                <button onclick="clearFilters()" class="text-xs text-rose-400 font-bold hover:text-rose-300 transition-colors uppercase tracking-wider">Temizle</button>
            </div>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wide mb-3">T√ºr</label>
                    <div class="flex bg-zinc-900 p-1.5 rounded-2xl border border-zinc-800">
                        <button onclick="setFilterType('all')" id="f-btn-all" class="flex-1 py-2.5 rounded-xl text-sm font-bold bg-[#27272a] text-white shadow-sm transition-all border border-zinc-700">T√ºm√º</button>
                        <button onclick="setFilterType('income')" id="f-btn-income" class="flex-1 py-2.5 rounded-xl text-sm font-bold text-zinc-500 transition-all">Gelir</button>
                        <button onclick="setFilterType('expense')" id="f-btn-expense" class="flex-1 py-2.5 rounded-xl text-sm font-bold text-zinc-500 transition-all">Gider</button>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wide mb-3">Min. Tutar</label>
                    <div class="relative">
                        <i class="ph-bold ph-money absolute left-5 top-1/2 -translate-y-1/2 text-zinc-500 text-lg"></i>
                        <input type="number" id="f-min-amount" class="w-full bg-[#121214] border border-zinc-800 rounded-2xl py-4 pl-12 pr-4 focus:outline-none focus:border-luxury-gold/50 text-white font-semibold placeholder:text-zinc-700" placeholder="0.00">
                    </div>
                </div>

                <label class="flex items-center justify-between p-4 bg-[#121214] rounded-2xl border border-zinc-800 cursor-pointer hover:border-zinc-700 transition-colors">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-luxury-gold/10 text-luxury-gold flex items-center justify-center">
                            <i class="ph-fill ph-calendar-check text-xl"></i>
                        </div>
                        <span class="text-sm font-bold text-zinc-300">Sadece Bu Ay</span>
                    </div>
                    <div class="relative inline-block w-12 align-middle select-none">
                        <input type="checkbox" name="toggle" id="f-this-month" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-zinc-500 border-4 border-[#121214] appearance-none cursor-pointer transition-all duration-300 left-0"/>
                        <label for="f-this-month" class="toggle-label block overflow-hidden h-6 rounded-full bg-zinc-800 cursor-pointer transition-colors"></label>
                    </div>
                </label>

                <button onclick="applyFilters()" class="w-full bg-white text-black font-bold py-4 rounded-2xl shadow-lg active:scale-[0.98] transition-transform text-lg">
                    Uygula
                </button>
            </div>
        </div>
    </div>

    <!-- BOR√á EKLEME MODALI -->
    <div id="addDebtModal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-black/90 backdrop-blur-xl" onclick="toggleModal('addDebtModal')"></div>
        <div class="absolute bottom-0 w-full bg-[#09090b] rounded-t-[2rem] p-6 shadow-2xl border-t border-zinc-800 transform transition-transform duration-300 translate-y-full" id="debt-modal-panel">
            <div class="w-10 h-1 bg-zinc-800 rounded-full mx-auto mb-6"></div>
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold text-white">Bor√ß Ekle</h2>
                <button onclick="toggleModal('addDebtModal')" class="p-2 bg-zinc-800 rounded-full text-zinc-400 hover:bg-zinc-700"><i class="ph-bold ph-x"></i></button>
            </div>
            
            <form onsubmit="handleAddDebt(event)" class="space-y-5">
                <div>
                    <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wide mb-2">T√ºr</label>
                    <div class="relative">
                        <select id="debt-category" class="w-full bg-[#121214] border border-zinc-800 rounded-2xl py-4 px-5 font-medium text-white focus:outline-none focus:border-luxury-gold/50 transition-all">
                            <option value="Kredi Kartƒ±">üí≥ Kredi Kartƒ±</option>
                            <option value="Kredi">bank Kredi</option>
                            <option value="Elden Bor√ß">ü§ù Elden Bor√ß</option>
                        </select>
                        <i class="ph-bold ph-caret-down absolute right-5 top-1/2 -translate-y-1/2 text-zinc-500 pointer-events-none"></i>
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wide mb-2">A√ßƒ±klama</label>
                    <input type="text" id="debt-name" required class="w-full bg-[#121214] border border-zinc-800 rounded-2xl py-4 px-5 font-medium text-white focus:outline-none focus:border-luxury-gold/50 transition-all" placeholder="√ñrn: Bonus Kart">
                </div>

                <div class="bg-[#121214] p-4 rounded-2xl border border-zinc-800">
                    <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wide mb-2">Tutar</label>
                    <div class="relative flex items-center">
                        <span class="text-2xl text-zinc-500 font-medium mr-2">‚Ç∫</span>
                        <input type="number" id="debt-amount" required class="w-full bg-transparent text-3xl font-bold text-white focus:outline-none placeholder:text-zinc-700" placeholder="0">
                    </div>
                </div>

                <div>
                    <label class="block text-[10px] font-bold text-zinc-500 uppercase tracking-wide mb-2">Son √ñdeme</label>
                    <input type="date" id="debt-date" class="w-full bg-[#121214] border border-zinc-800 rounded-2xl py-4 px-5 font-medium text-white focus:outline-none focus:border-luxury-gold/50 transition-all">
                </div>

                <button type="submit" class="w-full bg-white text-black font-bold py-4 rounded-2xl shadow-xl active:scale-[0.98] transition-transform text-lg">
                    Kaydet
                </button>
            </form>
        </div>
    </div>

    <script>
        // --- VERƒ∞ Y√ñNETƒ∞Mƒ∞ ---
        const APP_DATA_KEY = 'finans_app_data_v1';
        let appData = JSON.parse(localStorage.getItem(APP_DATA_KEY)) || { transactions: [], debts: [], balance: 0 };
        if(appData.debts) { appData.debts = appData.debts.map(d => ({ ...d, type: d.type || 'debt', category: d.category || 'Elden Bor√ß', id: d.id || Date.now() + Math.random() })); }
        function saveData() { localStorage.setItem(APP_DATA_KEY, JSON.stringify(appData)); updateUI(); }

        // --- GLOBAL ---
        let currentTxType = 'expense';
        let isBalanceVisible = false;
        let activeSort = 'newest';
        let activeFilters = { type: 'all', minAmount: '', thisMonth: false };

        // --- HELPER FUNC ---
        function toggleBalance(e) { e.preventDefault(); e.stopPropagation(); isBalanceVisible = !isBalanceVisible; renderTab('dashboard'); }
        function toggleModal(modalId) {
            const modal = document.getElementById(modalId);
            const panel = modal.querySelector('div[id$="panel"]');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => { panel.style.transform = 'translateY(0)'; }, 10);
                if(modalId === 'addTransactionModal') { 
                    // Varsayƒ±lan olarak GELƒ∞R (Income) se√ß
                    setTxType('income'); 
                    document.getElementById('tx-category').value = 'Maa≈ü'; 
                    document.getElementById('debt-selector-wrapper').classList.add('hidden'); 
                }
            } else {
                panel.style.transform = 'translateY(100%)';
                setTimeout(() => { modal.classList.add('hidden'); }, 300);
            }
        }
        function getCategoryIcon(cat) {
            const icons = { 'Market': 'ph-shopping-cart', 'Fatura': 'ph-receipt', 'Kira': 'ph-house-line', 'Ula≈üƒ±m': 'ph-bus', 'Yemek': 'ph-hamburger', 'Sigara': 'ph-cigarette', 'Eƒüitim': 'ph-books', 'Giyim': 'ph-t-shirt', 'Saƒülƒ±k': 'ph-first-aid', 'Eƒülence': 'ph-confetti', 'Maa≈ü': 'ph-money', 'Bor√ß √ñdeme': 'ph-hand-coins', 'Diƒüer': 'ph-dots-three-circle' };
            return icons[cat] || 'ph-circle';
        }
        function setSort(sortType) { activeSort = sortType; renderDashboard(document.getElementById('main-content')); }
        function setFilterType(type) {
            activeFilters.type = type;
            ['all', 'income', 'expense'].forEach(t => {
                const btn = document.getElementById(`f-btn-${t}`);
                if (t === type) { btn.className = 'flex-1 py-2.5 rounded-xl text-sm font-bold bg-[#27272a] text-white shadow-sm transition-all border border-zinc-700'; } 
                else { btn.className = 'flex-1 py-2.5 rounded-xl text-sm font-bold text-zinc-500 transition-all'; }
            });
        }
        function clearFilters() { activeFilters = { type: 'all', minAmount: '', thisMonth: false }; document.getElementById('f-min-amount').value = ''; document.getElementById('f-this-month').checked = false; setFilterType('all'); toggleModal('filterModal'); renderDashboard(document.getElementById('main-content')); }
        function applyFilters() { activeFilters.minAmount = document.getElementById('f-min-amount').value ? parseFloat(document.getElementById('f-min-amount').value) : ''; activeFilters.thisMonth = document.getElementById('f-this-month').checked; toggleModal('filterModal'); renderDashboard(document.getElementById('main-content')); }
        function updateUI() { const activeTabBtn = document.querySelector('.nav-item.active'); if(activeTabBtn) { renderTab(activeTabBtn.getAttribute('data-tab')); } }
        function switchTab(tabName) {
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.remove('active', 'text-white');
                const i = btn.querySelector('i'); if(i) { i.classList.remove('ph-fill'); i.classList.add('ph'); i.style.textShadow = 'none'; i.style.transform = 'none';}
            });
            const activeBtn = document.querySelector(`[data-tab="${tabName}"]`);
            activeBtn.classList.add('active', 'text-white');
            activeBtn.querySelector('i').classList.add('ph-fill');
            renderTab(tabName);
        }

        // --- RENDER ---
        function renderTab(tabName) {
            const main = document.getElementById('main-content');
            const title = document.getElementById('page-title');
            main.innerHTML = '';
            if (tabName === 'dashboard') {
                title.innerHTML = `<span class="flex items-center gap-2 text-gradient-gold"><i class="ph-fill ph-wallet text-luxury-gold"></i> C√ºzdan</span>`;
                renderDashboard(main);
            } else if (tabName === 'wallet') { title.innerText = 'Finansal Analiz'; renderWallet(main); }
            else if (tabName === 'debts') { title.innerText = 'Bor√ß Y√∂netimi'; renderDebts(main); }
            else if (tabName === 'settings') { title.innerText = 'Ayarlar'; renderSettings(main); }
        }

        function renderDashboard(container) {
            const totalIncome = appData.transactions.filter(t => t.type === 'income').reduce((acc, c) => acc + c.amount, 0);
            const totalExpense = appData.transactions.filter(t => t.type === 'expense').reduce((acc, c) => acc + c.amount, 0);
            const balance = totalIncome - totalExpense;
            const balanceText = isBalanceVisible ? `‚Ç∫${balance.toLocaleString('tr-TR', {minimumFractionDigits: 2})}` : '‚Ç∫******';
            const eyeIcon = isBalanceVisible ? 'ph-eye' : 'ph-eye-slash';

            let displayedTransactions = [...appData.transactions];
            if (activeFilters.type !== 'all') displayedTransactions = displayedTransactions.filter(t => t.type === activeFilters.type);
            if (activeFilters.minAmount !== '') displayedTransactions = displayedTransactions.filter(t => t.amount >= activeFilters.minAmount);
            if (activeFilters.thisMonth) {
                const now = new Date();
                displayedTransactions = displayedTransactions.filter(t => {
                    const parts = t.date.split('.');
                    return parseInt(parts[1]) === (now.getMonth() + 1) && parseInt(parts[2]) === now.getFullYear();
                });
            }
            if (activeSort === 'newest') displayedTransactions.sort((a, b) => b.id - a.id);
            else if (activeSort === 'oldest') displayedTransactions.sort((a, b) => a.id - b.id);
            else if (activeSort === 'highest') displayedTransactions.sort((a, b) => b.amount - a.amount);
            else if (activeSort === 'lowest') displayedTransactions.sort((a, b) => a.amount - b.amount);

            const isFilterActive = activeFilters.type !== 'all' || activeFilters.minAmount !== '' || activeFilters.thisMonth;
            const filterSummary = isFilterActive ? `<div class="mb-4 animate-fade-in-up"><span class="bg-luxury-gold/10 text-luxury-gold px-3 py-1.5 rounded-full text-xs font-bold border border-luxury-gold/20 flex items-center gap-1 w-fit"><i class="ph-bold ph-funnel"></i> Filtre Aktif: ${displayedTransactions.length}</span></div>` : '';
            const txList = displayedTransactions.slice(0, 10);

            container.innerHTML = `
                <details class="group mb-8 animate-fade-in-up">
                    <summary class="flex justify-between items-center p-6 bg-gradient-to-br from-zinc-900 to-black rounded-[2rem] border border-zinc-800 cursor-pointer select-none hover:border-zinc-700 transition-colors shadow-lg">
                        <div class="flex items-center gap-5">
                            <div class="bg-zinc-800/50 w-14 h-14 rounded-2xl flex items-center justify-center border border-zinc-700/50">
                                <i class="ph-fill ph-wallet text-2xl text-luxury-gold"></i>
                            </div>
                            <div>
                                <p class="text-[10px] text-zinc-500 font-bold uppercase tracking-[0.15em] mb-1.5">Toplam Varlƒ±k</p>
                                <div class="flex items-center gap-3">
                                    <h2 class="text-3xl font-bold text-white tracking-tight">${balanceText}</h2>
                                    <button onclick="toggleBalance(event)" class="text-zinc-600 hover:text-white transition-colors p-1"><i class="ph ${eyeIcon} text-xl"></i></button>
                                </div>
                            </div>
                        </div>
                        <div class="bg-zinc-900 p-3 rounded-full text-zinc-500 group-hover:text-luxury-gold transition-all border border-zinc-800">
                            <i class="ph-bold ph-caret-down transition-transform duration-300 group-open:rotate-180 text-lg"></i>
                        </div>
                    </summary>
                    <div class="pt-4 animate-fade-in-up">
                        <div class="bg-[#0c0c0e] border border-zinc-800/80 p-6 rounded-[2rem] relative overflow-hidden">
                            <div class="absolute top-0 right-0 w-64 h-64 bg-luxury-gold/5 rounded-full -mr-20 -mt-20 blur-3xl"></div>
                            <div class="relative z-10 grid grid-cols-3 gap-3">
                                <div class="bg-zinc-900/30 p-4 rounded-2xl border border-white/5 flex flex-col justify-between h-[90px]">
                                    <span class="text-[10px] font-bold text-emerald-500 uppercase tracking-wide">Gelir</span>
                                    <p class="font-bold text-lg text-emerald-400">‚Ç∫${totalIncome.toLocaleString('tr-TR')}</p>
                                </div>
                                <div class="bg-zinc-900/30 p-4 rounded-2xl border border-white/5 flex flex-col justify-between h-[90px]">
                                    <span class="text-[10px] font-bold text-rose-500 uppercase tracking-wide">Gider</span>
                                    <p class="font-bold text-lg text-rose-400">‚Ç∫${totalExpense.toLocaleString('tr-TR')}</p>
                                </div>
                                <div class="bg-zinc-900/30 p-4 rounded-2xl border border-white/5 flex flex-col justify-between h-[90px]">
                                    <span class="text-[10px] font-bold text-luxury-gold uppercase tracking-wide">Net</span>
                                    <p class="font-bold text-lg text-luxury-gold">‚Ç∫${balance.toLocaleString('tr-TR')}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </details>

                <div class="mb-5 flex justify-between items-end">
                    <div>
                        <h3 class="font-bold text-white text-lg">Son ƒ∞≈ülemler</h3>
                        <p class="text-xs text-zinc-500 font-medium mt-0.5">Harcama hareketleri</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleModal('filterModal')" class="w-10 h-10 rounded-xl bg-[#121214] border border-zinc-800 text-zinc-400 flex items-center justify-center hover:bg-zinc-800 hover:text-white transition-all ${isFilterActive ? 'text-luxury-gold border-luxury-gold/30' : ''}"><i class="ph-bold ph-funnel text-lg"></i></button>
                        <button onclick="switchTab('wallet')" class="px-4 h-10 rounded-xl bg-zinc-900 text-zinc-300 border border-zinc-800 text-xs font-bold flex items-center hover:bg-zinc-800 hover:text-white transition-colors">T√ºm√ºn√º G√∂r</button>
                    </div>
                </div>
                ${filterSummary}
                <div class="flex gap-2 overflow-x-auto hide-scroll pb-4 mb-2">
                    ${['En Yeni', 'En Y√ºksek', 'En D√º≈ü√ºk', 'En Eski'].map((l, i) => {
                        const keys = ['newest', 'highest', 'lowest', 'oldest'];
                        const active = activeSort === keys[i];
                        return `<button onclick="setSort('${keys[i]}')" class="px-4 py-2 rounded-xl text-xs font-bold transition-all whitespace-nowrap border ${active ? 'bg-luxury-gold text-black border-luxury-gold shadow-lg shadow-luxury-gold/20' : 'bg-[#121214] text-zinc-500 border-zinc-800 hover:border-zinc-700 hover:text-zinc-300'}">${l}</button>`;
                    }).join('')}
                </div>

                <div class="space-y-3 pb-6">
                    ${txList.length === 0 ? `<div class="text-center py-16 bg-[#121214] rounded-[2rem] border border-dashed border-zinc-800"><div class="w-16 h-16 bg-zinc-900 rounded-full flex items-center justify-center mx-auto mb-4 border border-zinc-800"><i class="ph-fill ph-magnifying-glass text-3xl text-zinc-600"></i></div><p class="text-zinc-500 font-medium text-sm">ƒ∞≈ülem bulunamadƒ±.</p></div>` : ''}
                    ${txList.map((tx, i) => `
                        <div class="bg-[#121214] p-4 rounded-2xl border border-zinc-800/50 flex justify-between items-center group active:scale-[0.98] transition-all hover:bg-zinc-900/50 animate-fade-in-up stagger-${(i%5)+1}">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-2xl ${tx.type === 'income' ? 'bg-emerald-500/10 text-emerald-500 border border-emerald-500/20' : 'bg-rose-500/10 text-rose-500 border border-rose-500/20'} flex items-center justify-center text-xl shadow-sm">
                                    <i class="ph-fill ${getCategoryIcon(tx.category)}"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-zinc-200 text-[15px] mb-0.5">${tx.desc}</p>
                                    <p class="text-[10px] font-bold text-zinc-500 bg-zinc-900 px-2 py-0.5 rounded-md inline-block border border-zinc-800">${tx.date}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold ${tx.type === 'income' ? 'text-emerald-400' : 'text-zinc-200'} text-base">
                                    ${tx.type === 'income' ? '+' : '-'}‚Ç∫${tx.amount.toLocaleString('tr-TR')}
                                </p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderWallet(container) {
            const income = appData.transactions.filter(t => t.type === 'income').reduce((acc, c) => acc + c.amount, 0);
            const expense = appData.transactions.filter(t => t.type === 'expense').reduce((acc, c) => acc + c.amount, 0);
            const net = income - expense;
            
            let advice = { title: "Denge Durumu", desc: "Gelir ve giderleriniz dengede.", bg: "bg-zinc-900 border-zinc-800", icon: "ph-scales text-zinc-400" };
            if (net > 0) advice = { title: "Pozitif Akƒ±≈ü üöÄ", desc: `6 ayda yakla≈üƒ±k <strong>‚Ç∫${(net*6).toLocaleString('tr-TR')}</strong> birikim √∂ng√∂r√ºl√ºyor.`, bg: "bg-gradient-to-br from-emerald-900/40 to-emerald-950/40 border-emerald-900/50", icon: "ph-trend-up text-emerald-400" };
            else if (net < 0) advice = { title: "Negatif Akƒ±≈ü ‚ö†Ô∏è", desc: `Harcamalarƒ± kƒ±smazsan 6 ayda <strong>‚Ç∫${Math.abs(net*6).toLocaleString('tr-TR')}</strong> a√ßƒ±k verebilirsin.`, bg: "bg-gradient-to-br from-rose-900/40 to-rose-950/40 border-rose-900/50", icon: "ph-warning text-rose-400" };

            let healthScore = 50;
            if (income > 0) healthScore = Math.min(100, Math.max(0, 50 + ((income-expense)/income * 150)));
            else if (expense > 0) healthScore = 10;
            healthScore = Math.round(healthScore);
            
            let scoreColor = healthScore >= 80 ? "text-emerald-400" : healthScore < 40 ? "text-rose-400" : "text-orange-400";
            let strokeColor = healthScore >= 80 ? "#34d399" : healthScore < 40 ? "#fb7185" : "#fb923c";
            const strokeDashoffset = 251 - (healthScore / 100) * 251;

            const chartBars = Array.from({length:6}).map((_, i) => {
                const variation = 0.8 + Math.random() * 0.3;
                const max = Math.max(income, expense) || 100;
                return { label: i===0?'≈ûimdi':`${i} Ay`, hInc: (i===0?income:income*variation)/max*100, hExp: (i===0?expense:expense*variation)/max*100 };
            }).reverse();

            container.innerHTML = `
                <div class="${advice.bg} border p-6 rounded-[2rem] mb-6 relative overflow-hidden animate-fade-in-up">
                    <div class="relative z-10">
                        <div class="flex items-center gap-2 mb-2">
                            <i class="ph-fill ${advice.icon} text-xl"></i><span class="text-[10px] font-bold tracking-widest uppercase text-zinc-400">Gelecek Tahmini</span>
                        </div>
                        <h2 class="text-xl font-bold text-white mb-1">${advice.title}</h2>
                        <p class="text-sm text-zinc-300 leading-relaxed font-medium">${advice.desc}</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
                    <div class="bg-[#121214] p-6 rounded-[2rem] border border-zinc-800 flex flex-col items-center relative animate-fade-in-up stagger-1">
                         <h3 class="font-bold text-zinc-300 text-sm mb-4 w-full">Finansal Saƒülƒ±k</h3>
                         <div class="relative w-36 h-36">
                            <svg class="w-full h-full transform -rotate-90 drop-shadow-[0_0_15px_rgba(0,0,0,0.5)]"><circle cx="72" cy="72" r="40" stroke="#27272a" stroke-width="8" fill="transparent" /><circle cx="72" cy="72" r="40" stroke="${strokeColor}" stroke-width="8" fill="transparent" stroke-dasharray="251" stroke-dashoffset="${strokeDashoffset}" stroke-linecap="round" class="transition-all duration-1000 ease-out" /></svg>
                            <div class="absolute inset-0 flex flex-col items-center justify-center"><span class="text-4xl font-bold ${scoreColor}">${healthScore}</span></div>
                         </div>
                    </div>
                    <div class="bg-[#121214] p-6 rounded-[2rem] border border-zinc-800 animate-fade-in-up stagger-2">
                        <div class="flex justify-between items-center mb-6">
                             <h3 class="font-bold text-zinc-300 text-sm">G√∂r√ºn√ºm</h3>
                             <div class="flex gap-3 text-[10px] font-bold"><div class="flex items-center gap-1.5 text-emerald-400"><div class="w-2 h-2 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.5)]"></div>Gelir</div><div class="flex items-center gap-1.5 text-rose-400"><div class="w-2 h-2 rounded-full bg-rose-500 shadow-[0_0_8px_rgba(244,63,94,0.5)]"></div>Gider</div></div>
                        </div>
                        <div class="flex items-end justify-between h-32 gap-3">
                            ${chartBars.map(bar => `<div class="flex flex-col items-center gap-2 w-full h-full justify-end group"><div class="flex items-end justify-center w-full gap-1 h-full relative"><div style="height: ${Math.max(10, bar.hInc)}%" class="w-1.5 bg-emerald-500 rounded-full opacity-60 group-hover:opacity-100 transition-all shadow-[0_0_12px_rgba(16,185,129,0.4)]"></div><div style="height: ${Math.max(10, bar.hExp)}%" class="w-1.5 bg-rose-500 rounded-full opacity-60 group-hover:opacity-100 transition-all shadow-[0_0_12px_rgba(244,63,94,0.4)]"></div></div><span class="text-[9px] text-zinc-600 font-bold uppercase group-hover:text-zinc-400 transition-colors">${bar.label}</span></div>`).join('')}
                        </div>
                    </div>
                </div>
                <h3 class="font-bold text-zinc-300 text-sm mb-4 ml-1 uppercase tracking-wide">Kategori Analizi</h3>
                ${renderCategoryAnalysis()}
            `;
        }

        function renderCategoryAnalysis() {
            const expenses = appData.transactions.filter(t => t.type === 'expense');
            const categories = {};
            let totalExp = 0;
            expenses.forEach(tx => { categories[tx.category] = (categories[tx.category] || 0) + tx.amount; totalExp += tx.amount; });
            
            if(Object.keys(categories).length === 0) return '<div class="bg-[#121214] p-8 rounded-[2rem] border border-dashed border-zinc-800 text-center text-zinc-500 text-sm font-medium">Veri yok.</div>';
            
            return `<div class="bg-[#121214] p-6 rounded-[2rem] border border-zinc-800 animate-fade-in-up stagger-3">${Object.keys(categories).map(cat => {
                const percent = totalExp > 0 ? (categories[cat]/totalExp)*100 : 0;
                return `<div class="mb-5 last:mb-0"><div class="flex justify-between text-sm mb-2"><span class="font-bold text-zinc-300 flex items-center gap-2"><i class="ph-fill ${getCategoryIcon(cat)} text-luxury-gold"></i> ${cat}</span><span class="text-zinc-400 font-medium">‚Ç∫${categories[cat].toLocaleString('tr-TR')}</span></div><div class="w-full bg-zinc-900 rounded-full h-1.5 overflow-hidden"><div class="bg-luxury-gold h-1.5 rounded-full shadow-[0_0_10px_rgba(212,175,55,0.4)]" style="width: ${percent}%"></div></div></div>`;
            }).join('')}</div>`;
        }

        function renderDebts(container) {
            const debts = appData.debts.filter(d => d.type === 'debt');
            const categories = { 'Kredi Kartƒ±': { amount: 0, count: 0, icon: 'ph-credit-card', color: 'text-purple-400 bg-purple-500/10 border-purple-500/20' }, 'Kredi': { amount: 0, count: 0, icon: 'ph-bank', color: 'text-blue-400 bg-blue-500/10 border-blue-500/20' }, 'Elden Bor√ß': { amount: 0, count: 0, icon: 'ph-hand-coins', color: 'text-orange-400 bg-orange-500/10 border-orange-500/20' } };
            let totalDebt = 0;
            debts.forEach(d => { const cat = d.category || 'Elden Bor√ß'; if(categories[cat]) { categories[cat].amount += d.amount; categories[cat].count += 1; } totalDebt += d.amount; });

            container.innerHTML = `
                <div class="grid grid-cols-1 gap-3 mb-8">
                    ${Object.entries(categories).map(([name, data], i) => `
                        <div class="bg-[#121214] p-5 rounded-[1.5rem] border border-zinc-800 flex items-center justify-between group transition-all hover:bg-zinc-900 animate-fade-in-up stagger-${i+1}">
                            <div class="flex items-center gap-4">
                                <div class="w-14 h-14 rounded-2xl ${data.color} flex items-center justify-center text-2xl shadow-sm border">
                                    <i class="ph-fill ${data.icon}"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-white text-[15px] mb-0.5">${name}</h4>
                                    <p class="text-[10px] text-zinc-400 font-bold bg-zinc-900 px-2 py-0.5 rounded-md w-fit border border-zinc-800">${data.count} Kayƒ±t</p>
                                </div>
                            </div>
                            <div class="flex flex-col items-end gap-3">
                                <span class="font-bold text-zinc-200 text-lg">‚Ç∫${data.amount.toLocaleString('tr-TR')}</span>
                                <button onclick="openAddDebtModal('${name}')" class="w-9 h-9 rounded-full bg-white text-black flex items-center justify-center shadow-lg shadow-white/10 active:scale-90 transition-transform"><i class="ph-bold ph-plus"></i></button>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <h3 class="font-bold text-zinc-300 text-sm mb-4 ml-1 uppercase tracking-wide">Bor√ß Listesi</h3>
                <div class="space-y-3 pb-32">
                    ${debts.length === 0 ? `<div class="text-center py-12 bg-[#121214] rounded-[2rem] border border-dashed border-zinc-800"><i class="ph-fill ph-check-circle text-4xl text-zinc-700 mb-3 block"></i><span class="text-zinc-500 font-medium">Borcunuz yok.</span></div>` : ''}
                    ${debts.map((item, i) => {
                        let dateText = 'Tarih yok', dateClass = 'bg-zinc-900 text-zinc-500 border border-zinc-800';
                        if (item.date) {
                            const today = new Date(); const dP = item.date.split('.'); const due = new Date(dP[2], dP[1]-1, dP[0]);
                            const diffDays = Math.ceil((due - today) / (1000 * 60 * 60 * 24));
                            if (diffDays < 0) { dateText = `${Math.abs(diffDays)} g√ºn gecikti`; dateClass = 'bg-rose-900/20 text-rose-400 border border-rose-900/30'; }
                            else if (diffDays === 0) { dateText = 'Bug√ºn'; dateClass = 'bg-orange-900/20 text-orange-400 border border-orange-900/30'; }
                            else { dateText = `${diffDays} g√ºn kaldƒ±`; dateClass = 'bg-blue-900/20 text-blue-400 border border-blue-900/30'; }
                        }
                        const catData = categories[item.category] || categories['Elden Bor√ß'];
                        return `
                        <div class="bg-[#121214] p-4 rounded-2xl border border-zinc-800/50 flex items-center justify-between animate-fade-in-up stagger-${(i%5)+1}">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-2xl ${catData.color.replace('border-', '')} flex items-center justify-center text-xl">
                                    <i class="ph-fill ${catData.icon}"></i>
                                </div>
                                <div>
                                    <h4 class="font-bold text-white text-[15px] mb-0.5">${item.name}</h4>
                                    <span class="text-[10px] font-bold px-2 py-0.5 rounded-md ${dateClass}">${dateText}</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-zinc-200 mb-1.5">‚Ç∫${item.amount.toLocaleString('tr-TR')}</p>
                                <div class="flex gap-1.5 justify-end">
                                    <button onclick="payDebt('${item.name}', ${item.amount}, 'debt')" class="w-8 h-8 rounded-xl bg-emerald-900/20 text-emerald-400 border border-emerald-900/30 flex items-center justify-center hover:bg-emerald-900/40 transition-colors"><i class="ph-bold ph-check text-sm"></i></button>
                                    <button onclick="deleteDebtByName('${item.name}')" class="w-8 h-8 rounded-xl bg-zinc-800 text-zinc-400 flex items-center justify-center hover:bg-rose-900/30 hover:text-rose-400 transition-colors"><i class="ph-bold ph-trash text-sm"></i></button>
                                </div>
                            </div>
                        </div>`;
                    }).join('')}
                </div>
                <div class="fixed bottom-28 left-5 right-5 z-30">
                    <div class="bg-gradient-to-r from-zinc-100 to-white text-black p-5 rounded-[1.5rem] shadow-2xl shadow-white/10 flex justify-between items-center animate-fade-in-up ring-4 ring-black/50">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 rounded-2xl bg-black/5 flex items-center justify-center border border-black/5"><i class="ph-fill ph-sigma text-2xl"></i></div>
                            <div><p class="text-[10px] text-zinc-500 font-bold uppercase tracking-wider mb-0.5">Toplam Bor√ß</p><p class="font-black text-2xl tracking-tight">‚Ç∫${totalDebt.toLocaleString('tr-TR')}</p></div>
                        </div>
                        <button onclick="toggleModal('addDebtModal')" class="bg-black hover:bg-zinc-800 text-white px-5 py-3 rounded-xl text-xs font-bold transition-all shadow-lg">Hƒ±zlƒ± Ekle</button>
                    </div>
                </div>
            `;
        }

        function renderSettings(container) {
            container.innerHTML = `
                <div class="space-y-4 animate-fade-in-up">
                    <div class="bg-[#121214] rounded-[2rem] border border-zinc-800 overflow-hidden">
                        <div class="p-6 border-b border-zinc-800 flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-zinc-900 flex items-center justify-center border border-zinc-800"><i class="ph-fill ph-user text-2xl text-zinc-500"></i></div>
                            <div><h3 class="font-bold text-white">Kullanƒ±cƒ±</h3><p class="text-xs text-luxury-gold font-bold">Premium √úye</p></div>
                        </div>
                        <button onclick="if(confirm('T√ºm veriler silinecek. Emin misin?')) { localStorage.removeItem(APP_DATA_KEY); location.reload(); }" class="w-full p-5 text-left flex items-center gap-3 text-rose-500 hover:bg-rose-900/10 transition-colors font-bold text-sm">
                            <div class="w-10 h-10 rounded-xl bg-rose-900/20 flex items-center justify-center"><i class="ph-bold ph-trash text-lg"></i></div> Verileri Sƒ±fƒ±rla
                        </button>
                    </div>
                    <div class="bg-[#121214] rounded-[2rem] p-6 border border-zinc-800 flex items-center gap-4 text-zinc-500">
                        <i class="ph-fill ph-info text-2xl text-luxury-gold"></i>
                        <div><p class="font-bold text-sm text-zinc-300">Finans Asistanƒ±m</p><p class="text-[11px] font-medium">v2.1 ‚Ä¢ Obsidian & Gold</p></div>
                    </div>
                </div>
            `;
        }

        // --- Debt Helpers ---
        function openAddDebtModal(cat) { toggleModal('addDebtModal'); const s = document.getElementById('debt-category'); if(s) s.value = cat; }
        function handleAddDebt(e) {
            e.preventDefault();
            const cat = document.getElementById('debt-category').value, name = document.getElementById('debt-name').value, amt = parseFloat(document.getElementById('debt-amount').value), date = document.getElementById('debt-date').value;
            let fDate = ''; if(date) { const p = date.split('-'); fDate = `${p[2]}.${p[1]}.${p[0]}`; }
            appData.debts.push({ id: Date.now(), type: 'debt', category: cat, name, amount: amt, date: fDate });
            saveData(); toggleModal('addDebtModal'); e.target.reset(); if(document.querySelector('[data-tab="debts"]').classList.contains('active')) renderTab('debts');
        }
        function payDebt(name, amt, type) {
            if(confirm(`Bu borcu √∂dendi olarak i≈üaretlemek istiyor musun?`)) {
                const idx = appData.debts.findIndex(d => d.name === name && d.amount === amt && d.type === 'debt');
                if (idx > -1) {
                    const item = appData.debts[idx]; appData.debts.splice(idx, 1);
                    appData.transactions.push({ id: Date.now(), type: 'expense', amount: amt, desc: `Bor√ß √ñdemesi: ${name}`, category: 'Diƒüer', date: new Date().toLocaleDateString('tr-TR') });
                    saveData(); renderTab('debts');
                }
            }
        }
        function deleteDebtByName(name) { if(confirm('Silmek istediƒüine emin misin?')) { const idx = appData.debts.findIndex(d => d.name === name); if(idx > -1) { appData.debts.splice(idx, 1); saveData(); renderTab('debts'); } } }

        // --- Transaction Helpers ---
        function setTxType(type) {
            currentTxType = type;
            const inc = document.getElementById('btn-income'), exp = document.getElementById('btn-expense'), debtOpt = document.getElementById('opt-debt-payment');
            if (type === 'income') {
                inc.className = 'flex-1 py-3.5 rounded-xl text-sm font-bold transition-all duration-300 bg-emerald-900/80 text-emerald-400 border border-emerald-500/20 shadow-lg';
                exp.className = 'flex-1 py-3.5 rounded-xl text-sm font-bold transition-all duration-300 text-zinc-500 hover:text-white';
                if(debtOpt) debtOpt.classList.add('hidden');
                if(document.getElementById('tx-category').value === 'Bor√ß √ñdeme') checkCategory('Maa≈ü');
            } else {
                exp.className = 'flex-1 py-3.5 rounded-xl text-sm font-bold transition-all duration-300 bg-rose-900/80 text-rose-400 border border-rose-500/20 shadow-lg';
                inc.className = 'flex-1 py-3.5 rounded-xl text-sm font-bold transition-all duration-300 text-zinc-500 hover:text-white';
                if(debtOpt) debtOpt.classList.remove('hidden');
            }
        }
        function checkCategory(val) {
            const wrap = document.getElementById('debt-selector-wrapper'), sel = document.getElementById('tx-debt-select');
            if (val === 'Bor√ß √ñdeme') {
                wrap.classList.remove('hidden');
                const debts = appData.debts.filter(d => d.type === 'debt');
                if (debts.length === 0) sel.innerHTML = '<option value="">√ñdenecek bor√ß bulunamadƒ±</option>';
                else { let o = '<option value="">Se√ßiniz...</option>'; debts.forEach(d => { o += `<option value="${d.id}">${d.name} (${d.amount.toLocaleString('tr-TR')}‚Ç∫)</option>`; }); sel.innerHTML = o; }
            } else { wrap.classList.add('hidden'); }
        }
        function handleAddTransaction(e) {
            e.preventDefault();
            const amt = parseFloat(document.getElementById('tx-amount').value), desc = document.getElementById('tx-desc').value, cat = document.getElementById('tx-category').value;
            if (cat === 'Bor√ß √ñdeme') {
                const dId = document.getElementById('tx-debt-select').value;
                if (!dId) { alert('L√ºtfen √∂denecek borcu se√ßin!'); return; }
                const idx = appData.debts.findIndex(d => d.id == dId);
                if (idx > -1) {
                    appData.debts[idx].amount -= amt;
                    if (appData.debts[idx].amount <= 0) { appData.debts.splice(idx, 1); alert(`"${appData.debts[idx]?.name || 'Bor√ß'}" tamamen kapandƒ±.`); }
                    else alert(`Kalan: ‚Ç∫${appData.debts[idx].amount.toLocaleString('tr-TR')}`);
                }
            }
            appData.transactions.push({ id: Date.now(), type: currentTxType, amount: amt, desc, category: cat, date: new Date().toLocaleDateString('tr-TR') });
            saveData(); toggleModal('addTransactionModal'); e.target.reset();
        }

        renderTab('dashboard');
    </script>
</body>
</html>
